<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="tonety"><title>PSR-7 HTTP消息接口规范 · Tonety</title><meta name="description" content="HTTP请求格式：
1234POST /path HTTP/1.1Host:example.comfoo=bar&amp;amp;baz=bat

​    意义：HTTP请求方法、请求的目标地址、HTTP协议， HTTP头信息，空行，消息内容

HTTP返回格式：
1234HTTP/1.1 200 OKC"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">Tonety</a></h3><div class="description"><p>啦啦啦啦啦啦啦啦</p></div></div></div><ul class="social-links"></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li><li><a href="/links">友链</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>PSR-7 HTTP消息接口规范</a></h3></div><div class="post-content"><p>HTTP请求格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /path HTTP/1.1</span><br><span class="line">Host:example.com</span><br><span class="line"></span><br><span class="line">foo=bar&amp;baz=bat</span><br></pre></td></tr></table></figure>
<blockquote>
<p>​    意义：HTTP请求方法、请求的目标地址、HTTP协议， HTTP头信息，空行，消息内容</p>
</blockquote>
<p>HTTP返回格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type:text/plain</span><br><span class="line"></span><br><span class="line">这是返回的内容</span><br></pre></td></tr></table></figure>
<blockquote>
<p>​    意义：第一行是状态行，包括HTTP协议版本，HTTP状态码，描述文本。HTTP头信息，空行，消息内容</p>
</blockquote>
<h4 id="1-详细描述"><a href="#1-详细描述" class="headerlink" title="1.详细描述"></a>1.详细描述</h4><h5 id="1-1-消息"><a href="#1-1-消息" class="headerlink" title="1.1 消息"></a>1.1 消息</h5><p> 一个 HTTP 消息是指来自于客户端到服务端的请求或者服务端到客户端的响应。以下这两个文档分别为 HTTP 的消息接口做了详细定义:<br><code>Psr\Http\Message\RequestInteface</code> 和 <code>Psr\Http\Message\ResponseInterface</code>。他们都继承<code>Psr\Http\Message\MessageInterface</code>接口。</p>
<hr>
<h5 id="1-2-HTTP请求头信息"><a href="#1-2-HTTP请求头信息" class="headerlink" title="1.2 HTTP请求头信息"></a>1.2 HTTP请求头信息</h5><p><strong>大小写不敏感的字段名称</strong></p>
<p>HTTP 消息包含大小写不敏感头信息。使用 <code>MessageInterface</code> 接口来设置和获取头信息，大小写不敏感的定义在于，如果你设置了一个 <code>Foo</code> 的头信息，<code>foo</code> 的值会被重写，你也可以通过 <code>foo</code> 来拿到 <code>FoO</code> 头对应的值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$message = $message-&gt;withHeader(&apos;foo&apos;,&apos;bar&apos;);</span><br><span class="line"></span><br><span class="line">echo $message-&gt;getHeaderLine(&apos;foo&apos;);//输出：bar</span><br><span class="line"></span><br><span class="line">echo $message-&gt;getHeaderLine(&apos;FOO&apos;);//输出：bar</span><br></pre></td></tr></table></figure>
<p>虽然头信息可以用大小写不敏感的方式取出，但是接口实现类 <strong>必须</strong> 保证自己的大小写规范，特别是用<code>getHeaders()</code>方法获取的内容。</p>
<hr>
<p><strong>对应多条数组的头信息</strong></p>
<p>为了适用一个HTTP【键】 可以对应多条数据的情况，我们使用字符串配合数组来实现，你可以从一个<code>MessageInterface</code>取出数组或字符串，使用<code>getHeaderLine($name)</code>方法可以获取通过逗号分隔的不区分大小写的字符串形式的所有值。也可以通过<code>getHeader($name)</code>获取数组形式头信息的所有值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$message = $message</span><br><span class="line">			-&gt;withHeader(&apos;foo&apos;,&apos;bar&apos;)</span><br><span class="line">			-&gt;withAddedHeader(&apos;foo&apos;,&apos;baz&apos;);</span><br><span class="line">			</span><br><span class="line">$header = $message-&gt;getHeaderLine(&apos;foo&apos;);// &apos;bar,baz&apos;</span><br><span class="line"></span><br><span class="line">$header = $message-&gt;getHeader(&apos;foo&apos;); // [&apos;bar&apos;,&apos;baz&apos;]</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>主机信息HOST</strong></p>
<p>在请求中，<code>Host</code>头信息通常和URI的host信息，还有建立起TCP连接使用的Host信息一致。然而，HTTP标准规范允许主机<code>host</code>信息与其他两个不一样。</p>
<p>在构建请求的时候，如果<code>host</code>头信息未提供的话，实现类库 <strong>必须</strong>尝试从URI中提取<code>host</code>信息。流程是 <code>RequestInterface::withUri()</code>会默认的从传参的<code>UriInterface</code>实例中提取<code>host</code>，并替代请求中原有的<code>host</code>信息。如果你提供第二个参数<code>true</code>来保证返回的消息实例中，原有的<code>host</code>头信息不会被替换掉。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public function withUri(UriInterface $uri, $preserveHost = false);</span><br></pre></td></tr></table></figure>
<p>总结：</p>
<p>头信息<code>host</code>不存在，默认情况下，会被传参的<code>UriInterface</code>实例中提取的<code>host</code>代替。 第二个参数设置为<code>true</code>后，则会使用URI中的<code>host</code>信息。</p>
<hr>
<h5 id="1-3-数据流"><a href="#1-3-数据流" class="headerlink" title="1.3 数据流"></a>1.3 数据流</h5><p><code>StreamInterface</code>以数据流的形式来读取消息内容，它提供了三个接口：<code>isReadable()</code>是否可读，<code>isWritable</code>是否可写，<code>isSeekable</code>是否可更改文件的指针。每一个数据流的实例，都会有多种功能：可以只读、可以只写、可以读和写、可以随机读取、可以按顺序读取等。 最终，<code>StreamInterface</code>定义一个<code>__toString()</code>的方法，用来一次性以字符串的形式输入所有消息内容。</p>
<p>与请求和响应的接口不同的是，<code>StreamInterface</code> 并不强调不可修改性。因为在 PHP 的实现内，基本上没有办法保证不可修改性，因为指针的指向，内容的变更等状态，都是不可控的。作为读取者，可以<br>调用只读的方法来返回数据流，以最大程度上保证数据流的不可修改性。使用者要时刻明确的知道数据流的可修改性，建议把数据流附加到消息实例中，来强迫不可修改的特性。</p>
<hr>
<h5 id="1-4-请求目标和URI"><a href="#1-4-请求目标和URI" class="headerlink" title="1.4 请求目标和URI"></a>1.4 请求目标和URI</h5><p>请求消息包含 [请求目标] 作为请求行的第二个段落。请求目标可以是一下形式之一：</p>
<ul>
<li><strong>原始形式</strong>，由路径和查询字符串（如果存在）组成；这通常被称为相对URL。通过TCP传输的消息通常是原始形式；scheme和认证数据通常仅通过CGI变量存在。</li>
<li><strong>绝对形式</strong> ，包括 scheme 、认证数据（「[user-info@]host[:port]」，其中括号中的项是可选的），路径（如果存在），查询字符串（如果存在）。这通常被称为绝对 URI，并且是 RFC 3986 中详细说明的唯一指定 URI 的形式。这个形式通常在向 HTTP 代理发出请求时使用。</li>
<li><strong>认证形式</strong> ，只包含认证信息。通常仅用于从 HTTP 客户端和代理服务器之间建立连接请求时使用。</li>
<li><strong>星号形式</strong> ，仅由字符串 <code>*</code> 组成，并与 OPTIONS 方法一起使用，以确定 Web 服务器的性能。</li>
</ul>
<p>除了这些请求目标之外，通常还有一个不同于请求目标的「有效 URL」。有效 URL 不在 HTTP 消息中传输，但它用于确定发出请求的协议（Http 或 Https）、端口和主机名。</p>
<p>当使用 <code>getRequestTarget()</code> 方法检索请求目标时，默认情况下此方法将使用 URI 对象并提取所有必要的组件来构建 <em>原始形式</em>。<em>原始形式</em> 是迄今为止最常见的请求目标。</p>
<p>如果用户希望使用其他三种形式中，或者如果想要显式覆盖请求目标，则可以使用 <code>withRequestTarget()</code> 来实现。</p>
<p>调用此方法不会影响 URI，因为 URI 是从 <code>getUri()</code> 返回的。</p>
<hr>
<h5 id="1-5-服务端请求"><a href="#1-5-服务端请求" class="headerlink" title="1.5 服务端请求"></a>1.5 服务端请求</h5><p><code>RequestInterface</code> 提供了 HTTP 请求消息的通常表示形式。但是，由于服务器端环境的性质，服务器端请求需要额外的处理。服务器端处理需要考虑通用网关接口（ CGI ），更具体地说，需要考虑 PHP 通过其服务器 API （ SAPI ）对 CGI 的抽象和扩展。PHP 通过超级全局变量提供了关于输入编组的简化，例如：</p>
<ul>
<li><code>$_COOKIE</code> ，反序列化了 HTTP cookie，并提供了简化的访问方式。</li>
<li><code>$_GET</code> ，反序列化了查询字符串并提供了简化的访问方式。</li>
<li><code>$_POST</code> ，对通过 urlencode 编码提交的 HTTP POST 信息进化反序列化并提供了简化的访问方式；通常可以认为是解析消息体的结果。</li>
<li><code>$_FILES</code> ，关于文件上传的元数据反序列化结果。</li>
<li><code>$_SERVER</code> ，提供了 CGI/SAPI 环境变量的访问，这些变量通常包括请求方法、请求 scheme、请求 URI 和报头。</li>
</ul>
<p><code>ServerRequestInterface</code> 继承于 <code>RequestInterface</code>，提供围绕这些超全局变量的抽象访问。这种做法有助于减少开发人员对超全局的耦合，鼓励对代码的测试，并提升了测试人员对相应代码的测试能力。</p>
<p>服务器请求提供了一个附加的属性，「attributes」，以便于开发人员可以根据应用程序的特定规则（例如路径匹配、scheme 匹配、主机匹配等）自检、分解和匹配请求。这样，服务器请求还可以在多段请求逻辑中进行消息传递。</p>
<hr>
<h5 id="1-6-文件上传"><a href="#1-6-文件上传" class="headerlink" title="1.6 文件上传"></a>1.6 文件上传</h5><p>超全局变量 <code>$_FILES</code> 在处理文件数组式的时候存在一些众所周知的问题。具体而言，页面的表单里有多个 input 框，name 属性是 <code>files[]</code>，然后提交文件，PHP 的 <code>$_FILES</code> 变量形式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">array(</span><br><span class="line">    &apos;files&apos; =&gt; array(</span><br><span class="line">        &apos;name&apos; =&gt; array(</span><br><span class="line">            0 =&gt; &apos;file0.txt&apos;,</span><br><span class="line">            1 =&gt; &apos;file1.html&apos;,</span><br><span class="line">        ),</span><br><span class="line">        &apos;type&apos; =&gt; array(</span><br><span class="line">            0 =&gt; &apos;text/plain&apos;,</span><br><span class="line">            1 =&gt; &apos;text/html&apos;,</span><br><span class="line">        ),</span><br><span class="line">        /* 等等其他属性 */</span><br><span class="line">    ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>而不是预期的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">array(</span><br><span class="line">    &apos;files&apos; =&gt; array(</span><br><span class="line">        0 =&gt; array(</span><br><span class="line">            &apos;name&apos; =&gt; &apos;file0.txt&apos;,</span><br><span class="line">            &apos;type&apos; =&gt; &apos;text/plain&apos;,</span><br><span class="line">            /* 等等其他属性 */</span><br><span class="line">        ),</span><br><span class="line">        1 =&gt; array(</span><br><span class="line">            &apos;name&apos; =&gt; &apos;file1.html&apos;,</span><br><span class="line">            &apos;type&apos; =&gt; &apos;text/html&apos;,</span><br><span class="line">            /* 等等其他属性 */</span><br><span class="line">        ),</span><br><span class="line">    ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>这样造成的结果是开发人员必须知道这种语言实现细节，并为之编写特定的代码。</p>
<hr>
<p>另外，如果发生以下情况， <code>$_FILES</code> 会是空数组：</p>
<ul>
<li>HTTP 方法不是 <code>POST</code>。</li>
<li>单元测试的时候。</li>
<li>在非 SAPI 环境下运行的时候，比如 <a href="http://reactphp.org/" target="_blank" rel="noopener">ReactPHP</a>。</li>
</ul>
<p>在这些情况下，数据需要以不同的方式获取。比如：</p>
<ul>
<li>进程可以解析消息体来发现上传的文件。这种情况下，实现方式可以选择不将上传文件写入文件系统，而是将它们包装在流中以减少内存、I/O 和存储开销。</li>
<li>在单元测试的场景下，开发人员需要能够对文件上桩或模仿的方式来验证和检查不同场景的情况。</li>
</ul>
<p><code>getUploadedFiles()</code> 将为开发者提供规范化的结构。实现方式的返回定义是：</p>
<ul>
<li>聚合上传文件的所有信息，并填充 <code>Psr\Http\Message\UploadedFileInterface</code> 实例。</li>
<li>重新创建提交的树结构，相应位置的叶结点都是一个适当的 <code>Psr\Http\Message\UploadedFileInterface</code> 实例。</li>
</ul>
<p>在最简单的示例中，这可能是单个被命名的提交表单元素：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;file&quot; name=&quot;avatar&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p>在这种情况下，<code>$_FILES</code> 的结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">array(</span><br><span class="line">    &apos;avatar&apos; =&gt; array(</span><br><span class="line">        &apos;tmp_name&apos; =&gt; &apos;phpUxcOty&apos;,</span><br><span class="line">        &apos;name&apos; =&gt; &apos;my-avatar.png&apos;,</span><br><span class="line">        &apos;size&apos; =&gt; 90996,</span><br><span class="line">        &apos;type&apos; =&gt; &apos;image/png&apos;,</span><br><span class="line">        &apos;error&apos; =&gt; 0,</span><br><span class="line">    ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><code>getUploadedFiles()</code> 返回的规范化形式将是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">array(</span><br><span class="line">    &apos;avatar&apos; =&gt; /* UploadedFileInterface 实例 */</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>input 名称是一种数组表示形式的情况：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;file&quot; name=&quot;my-form[details][avatar]&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p><code>$_FILES</code> 最终看下来像是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">array(</span><br><span class="line">    &apos;my-form&apos; =&gt; array(</span><br><span class="line">        &apos;details&apos; =&gt; array(</span><br><span class="line">            &apos;avatar&apos; =&gt; array(</span><br><span class="line">                &apos;tmp_name&apos; =&gt; &apos;phpUxcOty&apos;,</span><br><span class="line">                &apos;name&apos; =&gt; &apos;my-avatar.png&apos;,</span><br><span class="line">                &apos;size&apos; =&gt; 90996,</span><br><span class="line">                &apos;type&apos; =&gt; &apos;image/png&apos;,</span><br><span class="line">                &apos;error&apos; =&gt; 0,</span><br><span class="line">            ),</span><br><span class="line">        ),</span><br><span class="line">    ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><code>getUploadedFiles()</code> 的返回结果 <code>应该</code> 是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">array(</span><br><span class="line">    &apos;my-form&apos; =&gt; array(</span><br><span class="line">        &apos;details&apos; =&gt; array(</span><br><span class="line">            &apos;avatar&apos; =&gt; /* UploadedFileInterface 实例 */</span><br><span class="line">        ),</span><br><span class="line">    ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>在某些情况下，可以指定文件的 input 为一个数组：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Upload an avatar: &lt;input type=&quot;file&quot; name=&quot;my-form[details][avatars][]&quot; /&gt;</span><br><span class="line">Upload an avatar: &lt;input type=&quot;file&quot; name=&quot;my-form[details][avatars][]&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p>（例如，JavaScript 控件可能会产生额外的文件上传输入，以允许一次上传多个文件。）</p>
<p>这种情况下，其实现 <code>必须</code> 按给定的索引聚合所有上传文件的信息。因为这种情况下的 <code>$_FILES</code> 偏离了正常结构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">array(</span><br><span class="line">    &apos;my-form&apos; =&gt; array(</span><br><span class="line">        &apos;details&apos; =&gt; array(</span><br><span class="line">            &apos;avatars&apos; =&gt; array(</span><br><span class="line">                &apos;tmp_name&apos; =&gt; array(</span><br><span class="line">                    0 =&gt; &apos;...&apos;,</span><br><span class="line">                    1 =&gt; &apos;...&apos;,</span><br><span class="line">                    2 =&gt; &apos;...&apos;,</span><br><span class="line">                ),</span><br><span class="line">                &apos;name&apos; =&gt; array(</span><br><span class="line">                    0 =&gt; &apos;...&apos;,</span><br><span class="line">                    1 =&gt; &apos;...&apos;,</span><br><span class="line">                    2 =&gt; &apos;...&apos;,</span><br><span class="line">                ),</span><br><span class="line">                &apos;size&apos; =&gt; array(</span><br><span class="line">                    0 =&gt; &apos;...&apos;,</span><br><span class="line">                    1 =&gt; &apos;...&apos;,</span><br><span class="line">                    2 =&gt; &apos;...&apos;,</span><br><span class="line">                ),</span><br><span class="line">                &apos;type&apos; =&gt; array(</span><br><span class="line">                    0 =&gt; &apos;...&apos;,</span><br><span class="line">                    1 =&gt; &apos;...&apos;,</span><br><span class="line">                    2 =&gt; &apos;...&apos;,</span><br><span class="line">                ),</span><br><span class="line">                &apos;error&apos; =&gt; array(</span><br><span class="line">                    0 =&gt; &apos;...&apos;,</span><br><span class="line">                    1 =&gt; &apos;...&apos;,</span><br><span class="line">                    2 =&gt; &apos;...&apos;,</span><br><span class="line">                ),</span><br><span class="line">            ),</span><br><span class="line">        ),</span><br><span class="line">    ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>上面的 <code>$_FILES</code> 将对应于 <code>getUploadedFiles()</code> 返回的如下结构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">array(</span><br><span class="line">    &apos;my-form&apos; =&gt; array(</span><br><span class="line">        &apos;details&apos; =&gt; array(</span><br><span class="line">            &apos;avatars&apos; =&gt; array(</span><br><span class="line">                0 =&gt; /* UploadedFileInterface 实例 */,</span><br><span class="line">                1 =&gt; /* UploadedFileInterface 实例 */,</span><br><span class="line">                2 =&gt; /* UploadedFileInterface 实例 */,</span><br><span class="line">            ),</span><br><span class="line">        ),</span><br><span class="line">    ),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>开发人员可以用以下形式访问嵌套数组的索引 <code>1</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$request-&gt;getUploadedFiles()[&apos;my-form&apos;][&apos;details&apos;][&apos;avatars&apos;][1];</span><br></pre></td></tr></table></figure>
<p>因为上传的文件数据是派生的（派生于 <code>$_FILES</code> 或请求体），所以接口还有一个设置方法 <code>withUploadedFiles()</code>，允许修改其内容。</p>
<p>在原始示例的情形下，接口调用者的代码可能如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$file0 = $request-&gt;getUploadedFiles()[&apos;files&apos;][0];</span><br><span class="line">$file1 = $request-&gt;getUploadedFiles()[&apos;files&apos;][1];</span><br><span class="line"></span><br><span class="line">printf(</span><br><span class="line">    &quot;Received the files %s and %s&quot;,</span><br><span class="line">    $file0-&gt;getClientFilename(),</span><br><span class="line">    $file1-&gt;getClientFilename()</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">// &quot;Received the files file0.txt and file1.html&quot;</span><br></pre></td></tr></table></figure>
<p>这个设计方案还考虑到实现方案可以在非 SAPI 环境中运行。 As such, <code>UploadedFileInterface</code> provides methods for ensuring operations will work regardless of environment. 特别是：</p>
<ul>
<li><code>moveTo($targetPath)</code> 用来做为一个安全且推荐的代替在临时上传文件上调用 <code>move_uploaded_file()</code> 的方法。实现将根据环境检查正确的操作。</li>
<li><code>getStream()</code> 将会返回一个 <code>StreamInterface</code> 实例。在非 SAPI 环境中，提出的一种可能性是将单个上传文件解析为 <code>php://temp</code> 流而不是直接解析到文件；在这种情况下，不存在上传文件。 因此，无论环境如何，<code>getStream()</code> 都可以保证工作。</li>
</ul>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 移动文件至上传目录</span><br><span class="line">$filename = sprintf(</span><br><span class="line">    &apos;%s.%s&apos;,</span><br><span class="line">    create_uuid(),</span><br><span class="line">    pathinfo($file0-&gt;getClientFilename(), PATHINFO_EXTENSION)</span><br><span class="line">);</span><br><span class="line">$file0-&gt;moveTo(DATA_DIR . &apos;/&apos; . $filename);</span><br><span class="line"></span><br><span class="line">// 将文件流式传输至 Amazon S3。</span><br><span class="line">// 假设 $s3wrapper 是一个将写入 S3 的 PHP 流，而 Psr7StreamWrapper 是一个将 StreamInterface 作为 PHP StreamWrapper 进行装饰的类。</span><br><span class="line">$stream = new Psr7StreamWrapper($file1-&gt;getStream());</span><br><span class="line">stream_copy_to_stream($stream, $s3wrapper);</span><br></pre></td></tr></table></figure>
<h4 id="2-接口"><a href="#2-接口" class="headerlink" title="2. 接口"></a>2. 接口</h4><hr>
<h5 id="2-1-Psr-Http-Message-MessageInterface"><a href="#2-1-Psr-Http-Message-MessageInterface" class="headerlink" title="2.1 Psr\Http\Message\MessageInterface"></a>2.1 <code>Psr\Http\Message\MessageInterface</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace Psr\Http\Message;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * </span><br><span class="line"> * HTTP 消息包括客户端向服务器发起的「请求」和服务器端返回给客户端的「响应」。</span><br><span class="line"> * 此接口定义了他们通用的方法。</span><br><span class="line"> * </span><br><span class="line"> * HTTP 消息是被视为无法修改的，所有能修改状态的方法，都 **必须** 有一套</span><br><span class="line"> * 机制，在内部保持好原有的内容，然后把修改状态后的信息返回。</span><br><span class="line"> *</span><br><span class="line"> * @see http://www.ietf.org/rfc/rfc7230.txt</span><br><span class="line"> * @see http://www.ietf.org/rfc/rfc7231.txt</span><br><span class="line"> */</span><br><span class="line">interface MessageInterface</span><br><span class="line">&#123;</span><br><span class="line">    /**</span><br><span class="line">     * 获取字符串形式的 HTTP 协议版本信息。</span><br><span class="line">     *</span><br><span class="line">     * 字符串 **必须** 包含 HTTP 版本数字（如：「1.1」, 「1.0」）。</span><br><span class="line">     *</span><br><span class="line">     * @return string HTTP 协议版本</span><br><span class="line">     */</span><br><span class="line">    public function getProtocolVersion();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回指定 HTTP 版本号的消息实例。</span><br><span class="line">     *</span><br><span class="line">     * 传参的版本号只 **必须** 包含 HTTP 版本数字，如：&quot;1.1&quot;, &quot;1.0&quot;。</span><br><span class="line">     *</span><br><span class="line">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 消息对象，然后返回</span><br><span class="line">     * 一个新的带有传参进去的 HTTP 版本的实例</span><br><span class="line">     *</span><br><span class="line">     * @param string $version HTTP 版本信息</span><br><span class="line">     * @return self</span><br><span class="line">     */</span><br><span class="line">    public function withProtocolVersion($version);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取所有的报头信息</span><br><span class="line">     *</span><br><span class="line">     * 返回的二维数组中，第一维数组的「键」代表单条报头信息的名字，「值」是</span><br><span class="line">     * 以数组形式返回的，见以下实例：</span><br><span class="line">     *</span><br><span class="line">     *     // 把「值」的数据当成字串打印出来</span><br><span class="line">     *     foreach ($message-&gt;getHeaders() as $name =&gt; $values) &#123;</span><br><span class="line">     *         echo $name . &apos;: &apos; . implode(&apos;, &apos;, $values);</span><br><span class="line">     *     &#125;</span><br><span class="line">     *</span><br><span class="line">     *     // 迭代的循环二维数组</span><br><span class="line">     *     foreach ($message-&gt;getHeaders() as $name =&gt; $values) &#123;</span><br><span class="line">     *         foreach ($values as $value) &#123;</span><br><span class="line">     *             header(sprintf(&apos;%s: %s&apos;, $name, $value), false);</span><br><span class="line">     *         &#125;</span><br><span class="line">     *     &#125;</span><br><span class="line">     *</span><br><span class="line">     * 虽然报头信息是没有大小写之分，但是使用 `getHeaders()` 会返回保留了原本</span><br><span class="line">     * 大小写形式的内容。</span><br><span class="line">     *</span><br><span class="line">     * @return string[][] 返回一个两维数组，第一维数组的「键」 **必须** 为单条报头信息的</span><br><span class="line">     *     名称，对应的是由字串组成的数组，请注意，对应的「值」 **必须** 是数组形式的。</span><br><span class="line">     */</span><br><span class="line">    public function getHeaders();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 检查是否报头信息中包含有此名称的值，不区分大小写</span><br><span class="line">     *</span><br><span class="line">     * @param string $name 不区分大小写的报头信息名称</span><br><span class="line">     * @return bool 找到返回 true，未找到返回 false</span><br><span class="line">     */</span><br><span class="line">    public function hasHeader($name);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据给定的名称，获取一条报头信息，不区分大小写，以数组形式返回</span><br><span class="line">     *</span><br><span class="line">     * 此方法以数组形式返回对应名称的报头信息。</span><br><span class="line">     *</span><br><span class="line">     * 如果没有对应的报头信息，**必须** 返回一个空数组。</span><br><span class="line">     *</span><br><span class="line">     * @param string $name 不区分大小写的报头字段名称。</span><br><span class="line">     * @return string[] 返回报头信息中，对应名称的，由字符串组成的数组值，如果没有对应</span><br><span class="line">     *  的内容，**必须** 返回空数组。</span><br><span class="line">     */</span><br><span class="line">    public function getHeader($name);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据给定的名称，获取一条报头信息，不区分大小写，以逗号分隔的形式返回</span><br><span class="line">     * </span><br><span class="line">     * 此方法返回所有对应的报头信息，并将其使用逗号分隔的方法拼接起来。</span><br><span class="line">     *</span><br><span class="line">     * 注意：不是所有的报头信息都可使用逗号分隔的方法来拼接，对于那些报头信息，请使用</span><br><span class="line">     * `getHeader()` 方法来获取。</span><br><span class="line">     * </span><br><span class="line">     * 如果没有对应的报头信息，此方法 **必须** 返回一个空字符串。</span><br><span class="line">     *</span><br><span class="line">     * @param string $name 不区分大小写的报头字段名称。</span><br><span class="line">     * @return string 返回报头信息中，对应名称的，由逗号分隔组成的字串，如果没有对应</span><br><span class="line">     *  的内容，**必须** 返回空字符串。</span><br><span class="line">     */</span><br><span class="line">    public function getHeaderLine($name);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回替换指定报头信息「键/值」对的消息实例。</span><br><span class="line">     *</span><br><span class="line">     * 虽然报头信息是不区分大小写的，但是此方法必须保留其传参时的大小写状态，并能够在</span><br><span class="line">     * 调用 `getHeaders()` 的时候被取出。</span><br><span class="line">     *</span><br><span class="line">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 消息对象，然后返回</span><br><span class="line">     * 一个更新后带有传参进去报头信息的实例</span><br><span class="line">     *</span><br><span class="line">     * @param string $name 不区分大小写的报头字段名称。</span><br><span class="line">     * @param string|string[] $value 报头信息或报头信息数组。</span><br><span class="line">     * @return self</span><br><span class="line">     * @throws \InvalidArgumentException 无效的报头字段或报头信息时抛出</span><br><span class="line">     */</span><br><span class="line">    public function withHeader($name, $value);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回一个报头信息增量的 HTTP 消息实例。</span><br><span class="line">     *</span><br><span class="line">     * 原有的报头信息会被保留，新的值会作为增量加上，如果报头信息不存在的话，字段会被加上。</span><br><span class="line">     *</span><br><span class="line">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 消息对象，然后返回</span><br><span class="line">     * 一个新的修改过的 HTTP 消息实例。</span><br><span class="line">     *</span><br><span class="line">     * @param string $name 不区分大小写的报头字段名称。</span><br><span class="line">     * @param string|string[] $value 报头信息或报头信息数组。</span><br><span class="line">     * @return self</span><br><span class="line">     * @throws \InvalidArgumentException 报头字段名称非法时会被抛出。</span><br><span class="line">     * @throws \InvalidArgumentException 报头头信息的值非法的时候会被抛出。</span><br><span class="line">     */</span><br><span class="line">    public function withAddedHeader($name, $value);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回被移除掉指定报头信息的 HTTP 消息实例。</span><br><span class="line">     *</span><br><span class="line">     * 报头信息字段在解析的时候，**必须** 保证是不区分大小写的。</span><br><span class="line">     *</span><br><span class="line">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 消息对象，然后返回</span><br><span class="line">     * 一个新的修改过的 HTTP 消息实例。</span><br><span class="line">     *</span><br><span class="line">     * @param string $name 不区分大小写的头部字段名称。</span><br><span class="line">     * @return self</span><br><span class="line">     */</span><br><span class="line">    public function withoutHeader($name);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取 HTTP 消息的内容。</span><br><span class="line">     *</span><br><span class="line">     * @return StreamInterface 以数据流的形式返回。</span><br><span class="line">     */</span><br><span class="line">    public function getBody();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回指定内容的 HTTP 消息实例。</span><br><span class="line">     *</span><br><span class="line">     * 内容 **必须** 是 `StreamInterface` 接口的实例。</span><br><span class="line">     *</span><br><span class="line">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 消息对象，然后返回</span><br><span class="line">     * 一个新的修改过的 HTTP 消息实例。</span><br><span class="line">     *</span><br><span class="line">     * @param StreamInterface $body 数据流形式的内容。</span><br><span class="line">     * @return self</span><br><span class="line">     * @throws \InvalidArgumentException 当消息内容不正确的时候抛出。</span><br><span class="line">     */</span><br><span class="line">    public function withBody(StreamInterface $body);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="2-2-Psr-Http-Message-RequestInterface"><a href="#2-2-Psr-Http-Message-RequestInterface" class="headerlink" title="2.2 Psr\Http\Message\RequestInterface"></a>2.2 <code>Psr\Http\Message\RequestInterface</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace Psr\Http\Message;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 代表客户端向服务器发起请求的 HTTP 消息对象。</span><br><span class="line"> *</span><br><span class="line"> * 根据 HTTP 规范，此接口包含以下属性：</span><br><span class="line"> *</span><br><span class="line"> * - HTTP 协议版本号</span><br><span class="line"> * - HTTP 请求方法</span><br><span class="line"> * - URI</span><br><span class="line"> * - 报头信息</span><br><span class="line"> * - 消息内容</span><br><span class="line"> *</span><br><span class="line"> * 在构造 HTTP 请求对象的时候，如果没有提供 Host 信息，</span><br><span class="line"> * 实现类库 **必须** 从给出的 URI 中去提取 Host 信息。</span><br><span class="line"> *</span><br><span class="line"> * HTTP 请求是被视为无法修改的，所有能修改状态的方法，都 **必须** 有一套机制，在内部保</span><br><span class="line"> * 持好原有的内容，然后把修改状态后的新的 HTTP 请求实例返回。</span><br><span class="line"> */</span><br><span class="line">interface RequestInterface extends MessageInterface</span><br><span class="line">&#123;</span><br><span class="line">    /**</span><br><span class="line">     * 获取消息的请求目标。</span><br><span class="line">     * </span><br><span class="line">     * 获取消息的请求目标的使用场景，可能是在客户端，也可能是在服务器端，也可能是在指定信息的时候</span><br><span class="line">     * （参阅下方的 `withRequestTarget()`）。</span><br><span class="line">     * </span><br><span class="line">     * 在大部分情况下，此方法会返回组合 URI 的原始形式，除非被指定过（参阅下方的 `withRequestTarget()`）。</span><br><span class="line">     *</span><br><span class="line">     * 如果没有可用的 URI，并且没有设置过请求目标，此方法 **必须** 返回 「/」。</span><br><span class="line">     *</span><br><span class="line">     * @return string</span><br><span class="line">     */</span><br><span class="line">    public function getRequestTarget();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回一个指定目标的请求实例。</span><br><span class="line">     * </span><br><span class="line">     * 如果请求需要非原始形式的请求目标——例如指定绝对形式、认证形式或星号形式——则此方法</span><br><span class="line">     * 可用于创建指定请求目标的实例。</span><br><span class="line">     *</span><br><span class="line">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 请求实例，然后返回</span><br><span class="line">     * 一个新的修改过的 HTTP 请求实例。</span><br><span class="line">     *</span><br><span class="line">     * @see [http://tools.ietf.org/html/rfc7230#section-2.7](http://tools.ietf.org/html/rfc7230#section-2.7) </span><br><span class="line">     * （关于请求目标的各种允许的格式）</span><br><span class="line">     * </span><br><span class="line">     * @param mixed $requestTarget</span><br><span class="line">     * @return self</span><br><span class="line">     */</span><br><span class="line">    public function withRequestTarget($requestTarget);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取当前请求使用的 HTTP 方法</span><br><span class="line">     *</span><br><span class="line">     * @return string HTTP 方法字符串</span><br><span class="line">     */</span><br><span class="line">    public function getMethod();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回更改了请求方法的消息实例。</span><br><span class="line">     *</span><br><span class="line">     * 虽然，在大部分情况下，HTTP 请求方法都是使用大写字母来标示的，但是，实现类库 **不应该**</span><br><span class="line">     * 修改用户传参的大小格式。</span><br><span class="line">     * </span><br><span class="line">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 请求实例，然后返回</span><br><span class="line">     * 一个新的修改过的 HTTP 请求实例。</span><br><span class="line">     *</span><br><span class="line">     * @param string $method 大小写敏感的方法名</span><br><span class="line">     * @return self</span><br><span class="line">     * @throws \InvalidArgumentException 当非法的 HTTP 方法名传入时会抛出异常。</span><br><span class="line">     */</span><br><span class="line">    public function withMethod($method);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取 URI 实例。</span><br><span class="line">     *</span><br><span class="line">     * 此方法 **必须** 返回 `UriInterface` 的 URI 实例。</span><br><span class="line">     *</span><br><span class="line">     * @see http://tools.ietf.org/html/rfc3986#section-4.3</span><br><span class="line">     * @return UriInterface 返回与当前请求相关的 `UriInterface` 类型的 URI 实例。</span><br><span class="line">     */</span><br><span class="line">    public function getUri();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回修改了 URI 的消息实例。</span><br><span class="line">     *</span><br><span class="line">     * 当传入的 URI 包含有 HOST 信息时，此方法 **必须** 更新 HOST 信息。如果 URI </span><br><span class="line">     * 实例没有附带 HOST 信息，任何之前存在的 HOST 信息 **必须** 作为候补，应用</span><br><span class="line">     * 更改到返回的消息实例里。</span><br><span class="line">     * </span><br><span class="line">     * 你可以通过传入第二个参数来，来干预方法的处理，当 `$preserveHost` 设置为 `true` </span><br><span class="line">     * 的时候，会保留原来的 HOST 信息。当 `$preserveHost` 设置为 `true` 时，此方法</span><br><span class="line">     * 会如下处理 HOST 信息：</span><br><span class="line">     * </span><br><span class="line">     * - 如果 HOST 信息不存在或为空，并且新 URI 包含 HOST 信息，则此方法 **必须** 更新返回请求中的 HOST 信息。</span><br><span class="line">     * - 如果 HOST 信息不存在或为空，并且新 URI 不包含 HOST 信息，则此方法 **不得** 更新返回请求中的 HOST 信息。</span><br><span class="line">     * - 如果HOST 信息存在且不为空，则此方法 **不得** 更新返回请求中的 HOST 信息。</span><br><span class="line">     * </span><br><span class="line">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 请求实例，然后返回</span><br><span class="line">     * 一个新的修改过的 HTTP 请求实例。</span><br><span class="line">     *</span><br><span class="line">     * @see http://tools.ietf.org/html/rfc3986#section-4.3</span><br><span class="line">     * @param UriInterface $uri `UriInterface` 新的 URI 实例</span><br><span class="line">     * @param bool $preserveHost 是否保留原有的 HOST 头信息</span><br><span class="line">     * @return self</span><br><span class="line">     */</span><br><span class="line">    public function withUri(UriInterface $uri, $preserveHost = false);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="2-2-1-Psr-Http-Message-ServerRequestInterface"><a href="#2-2-1-Psr-Http-Message-ServerRequestInterface" class="headerlink" title="2.2.1 Psr\Http\Message\ServerRequestInterface"></a>2.2.1 <code>Psr\Http\Message\ServerRequestInterface</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace Psr\Http\Message;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 表示服务器端接收到的 HTTP 请求。</span><br><span class="line"> *</span><br><span class="line"> * 根据 HTTP 规范，此接口包含以下属性：</span><br><span class="line"> *</span><br><span class="line"> * - HTTP 协议版本号</span><br><span class="line"> * - HTTP 请求方法</span><br><span class="line"> * - URI</span><br><span class="line"> * - 报头信息</span><br><span class="line"> * - 消息内容</span><br><span class="line"> *</span><br><span class="line"> * 此外，它封闭了从 CGI 和/或 PHP 环境变量，包括：</span><br><span class="line"> *</span><br><span class="line"> * - `$_SERVER` 中表示的值。</span><br><span class="line"> * - 提供的任意 Cookie 信息（通常通过 `$_COOKIE` 获取）</span><br><span class="line"> * - 查询字符串参数（通常通过 `$_GET` 获取，或者通过 `parse_str()` 解析）</span><br><span class="line"> * - 如果存在的话，上传文件的信息（通常通过 `$_FILES` 获取）</span><br><span class="line"> * - 反序列化的消息体参数（通常来自于 `$_POST`）</span><br><span class="line"> *</span><br><span class="line"> * `$_SERVER` 的值 **必须** 被视为不可变的，因为代表了请求时应用程序的状态；因此，没有允许修改的方法。</span><br><span class="line"> * 其他值则提供了修改的方法，因为可以从 `$_SERVER` 或请求体中恢复，并且可能在应用程序中被处理</span><br><span class="line"> * （比如可能根据内容类型对消息体参数进行反序列化）。</span><br><span class="line"> *</span><br><span class="line"> * 此外，这个接口要识别请求的扩展信息和匹配其他的参数。</span><br><span class="line"> * （例如，通过 URI 进行路径匹配，解析 Cookie 值，反序列化非表单编码的消息体，报头中的用户名进行匹配认证）</span><br><span class="line"> * 这些参数存储在「attributes」中。</span><br><span class="line"> *</span><br><span class="line"> * HTTP 请求是被视为无法修改的，所有能修改状态的方法，都 **必须** 有一套机制，在内部保</span><br><span class="line"> * 持好原有的内容，然后把修改状态后的，新的 HTTP 请求实例返回。</span><br><span class="line"> */</span><br><span class="line">interface ServerRequestInterface extends RequestInterface</span><br><span class="line">&#123;</span><br><span class="line">    /**</span><br><span class="line">     * 返回服务器参数。</span><br><span class="line">     *</span><br><span class="line">     * 返回与请求环境相关的数据，通常从 PHP 的 `$_SERVER` 超全局变量中获取，但不是必然的。</span><br><span class="line">     *</span><br><span class="line">     * @return array</span><br><span class="line">     */</span><br><span class="line">    public function getServerParams();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取 Cookie 数据。</span><br><span class="line">     *</span><br><span class="line">     * 获取从客户端发往服务器的 Cookie 数据。</span><br><span class="line">     *</span><br><span class="line">     * 这个数据的结构 **必须** 和超全局变量 `$_COOKIE` 兼容。</span><br><span class="line">     *</span><br><span class="line">     * @return array</span><br><span class="line">     */</span><br><span class="line">    public function getCookieParams();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回具体指定 Cookie 的实例。</span><br><span class="line">     *</span><br><span class="line">     * 这个数据不是一定要来源于 `$_COOKIE`，但是 **必须** 与之结构兼容。通常在实例化时注入。</span><br><span class="line">     *</span><br><span class="line">     * 这个方法 **禁止** 更新实例中的 Cookie 报头和服务器参数中的相关值。</span><br><span class="line">     *</span><br><span class="line">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 消息实例，然后返回</span><br><span class="line">     * 一个新的修改过的 HTTP 消息实例。</span><br><span class="line">     * </span><br><span class="line">     * @param array $cookies 表示 Cookie 的键值对。</span><br><span class="line">     * @return self</span><br><span class="line">     */</span><br><span class="line">    public function withCookieParams(array $cookies);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取查询字符串参数。</span><br><span class="line">     *</span><br><span class="line">     * 如果可以的话，返回反序列化的查询字符串参数。</span><br><span class="line">     *</span><br><span class="line">     * 注意：查询参数可能与 URI 或服务器参数不同步。如果你需要确保只获取原始值，则可能需要调用</span><br><span class="line">     * `getUri()-&gt;getQuery()` 或服务器参数中的 `QUERY_STRING` 获取原始的查询字符串并自行解析。</span><br><span class="line">     *</span><br><span class="line">     * @return array</span><br><span class="line">     */</span><br><span class="line">    public function getQueryParams();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回具体指定查询字符串参数的实例。</span><br><span class="line">     *</span><br><span class="line">     * 这些值 **应该** 在传入请求的闭包中保持不变。它们 **可能** 在实例化的时候注入，</span><br><span class="line">     * 例如来自 `$_GET` 或者其他一些值（例如 URI）中得到。如果是通过解析 URI 获取，则</span><br><span class="line">     * 数据结构必须与 `parse_str()` 返回的内容兼容，以便处理查询参数、嵌套的代码可以复用。</span><br><span class="line">     *</span><br><span class="line">     * 设置查询字符串参数 **不得** 更改存储的 URI 和服务器参数中的值。</span><br><span class="line">     * </span><br><span class="line">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 消息实例，然后返回</span><br><span class="line">     * 一个新的修改过的 HTTP 消息实例。</span><br><span class="line">     *</span><br><span class="line">     * @param array $query 查询字符串参数数组，通常来源于 `$_GET`。</span><br><span class="line">     * @return self</span><br><span class="line">     */</span><br><span class="line">    public function withQueryParams(array $query);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取规范化的上传文件数据。</span><br><span class="line">     *</span><br><span class="line">     * 这个方法会规范化返回的上传文件元数据树结构，每个叶子结点都是 `Psr\Http\Message\UploadedFileInterface` 实例。</span><br><span class="line">     *</span><br><span class="line">     * 这些值 **可能** 在实例化的时候从 `$_FILES` 或消息体中获取，或者通过 `withUploadedFiles()` 获取。</span><br><span class="line">     *</span><br><span class="line">     * @return array `UploadedFileInterface` 的实例数组；如果没有数据则必须返回一个空数组。</span><br><span class="line">     */</span><br><span class="line">    public function getUploadedFiles();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回使用指定的上传文件数据的新实例。</span><br><span class="line">     *</span><br><span class="line">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 消息实例，然后返回</span><br><span class="line">     * 一个新的修改过的 HTTP 消息实例。</span><br><span class="line">     *</span><br><span class="line">     * @param array `UploadedFileInterface` 实例的树结构，类似于 `getUploadedFiles()` 的返回值。</span><br><span class="line">     * @return self</span><br><span class="line">     * @throws \InvalidArgumentException 如果提供无效的结构时抛出。</span><br><span class="line">     */</span><br><span class="line">    public function withUploadedFiles(array $uploadedFiles);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取请求消息体中的参数。</span><br><span class="line">     *</span><br><span class="line">     * 如果请求的 Content-Type 是 application/x-www-form-urlencoded 或 multipart/form-data 且请求方法是 POST，</span><br><span class="line">     * 则此方法 **必须** 返回 $_POST 的内容。</span><br><span class="line">     *</span><br><span class="line">     * 如果是其他情况，此方法可能返回反序列化请求正文内容的任何结果；当解析返回返回的结构化内容时，潜在的类型 **必须**</span><br><span class="line">     * 只能是数组或 `object` 类型。`null` 表示没有消息体内容。</span><br><span class="line">     *</span><br><span class="line">     * @return null|array|object 如果存在则返回反序列化消息体参数。一般是一个数组或 `object`。</span><br><span class="line">     */</span><br><span class="line">    public function getParsedBody();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回具有指定消息体参数的实例。</span><br><span class="line">     *</span><br><span class="line">     * **可能** 在实例化时注入。</span><br><span class="line">     *</span><br><span class="line">     * 如果请求的 Content-Type 是 application/x-www-form-urlencoded 或 multipart/form-data 且请求方法是 POST，</span><br><span class="line">     * 则方法的参数只能是 $_POST。</span><br><span class="line">     *</span><br><span class="line">     * 数据不一定要来自 $_POST，但是 **必须** 是反序列化请求正文内容的结果。由于需要反序列化/解析返回的结构化数据，</span><br><span class="line">     * 所以这个方法只接受数组、 `object` 类型和 `null`（如果没有可用的数据解析）。</span><br><span class="line">     *</span><br><span class="line">     * 例如，如果确定请求数据是一个 JSON，可以使用此方法创建具有反序列化参数的请求实例。</span><br><span class="line">     *</span><br><span class="line">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 消息实例，然后返回</span><br><span class="line">     * 一个新的修改过的 HTTP 消息实例。</span><br><span class="line">     *</span><br><span class="line">     * @param null|array|object $data 反序列化的消息体数据，通常是数组或 `object`。</span><br><span class="line">     * @return self</span><br><span class="line">     * @throws \InvalidArgumentException 如果提供的数据类型不支持。</span><br><span class="line">     */</span><br><span class="line">    public function withParsedBody($data);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取从请求派生的属性。</span><br><span class="line">     *</span><br><span class="line">     * 请求「attributes」可用于从请求导出的任意参数：比如路径匹配操作的结果；解密 Cookie 的结果；</span><br><span class="line">     * 反序列化非表单编码的消息体的结果；属性将是应用程序与请求特定的，并且可以是可变的。</span><br><span class="line">     *</span><br><span class="line">     * @return mixed[] 从请求派生的属性。</span><br><span class="line">     */</span><br><span class="line">    public function getAttributes();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取单个派生的请求属性。</span><br><span class="line">     *</span><br><span class="line">     * 获取 getAttributes() 中声明的某一个属性，如果不存在则返回提供的默认值。</span><br><span class="line">     *</span><br><span class="line">     * 这个方法不需要 hasAttribute 方法，因为允许在找不到指定属性的时候返回默认值。</span><br><span class="line">     *</span><br><span class="line">     * @see getAttributes()</span><br><span class="line">     * @param string $name 属性名称。</span><br><span class="line">     * @param mixed $default 如果属性不存在时返回的默认值。</span><br><span class="line">     * @return mixed</span><br><span class="line">     */</span><br><span class="line">    public function getAttribute($name, $default = null);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回具有指定派生属性的实例。</span><br><span class="line">     *</span><br><span class="line">     * 此方法允许设置 getAttributes() 中声明的单个派生的请求属性。</span><br><span class="line">     *</span><br><span class="line">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 消息实例，然后返回</span><br><span class="line">     * 一个新的修改过的 HTTP 消息实例。</span><br><span class="line">     *</span><br><span class="line">     * @see getAttributes()</span><br><span class="line">     * @param string $name 属性名。</span><br><span class="line">     * @param mixed $value 属性值。</span><br><span class="line">     * @return self</span><br><span class="line">     */</span><br><span class="line">    public function withAttribute($name, $value);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回移除指定属性的实例。</span><br><span class="line">     *</span><br><span class="line">     * 此方法允许移除 getAttributes() 中声明的单个派生的请求属性。</span><br><span class="line">     *</span><br><span class="line">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 消息实例，然后返回</span><br><span class="line">     * 一个新的修改过的 HTTP 消息实例。</span><br><span class="line">     *</span><br><span class="line">     * @see getAttributes()</span><br><span class="line">     * @param string $name 属性名。</span><br><span class="line">     * @return self</span><br><span class="line">     */</span><br><span class="line">    public function withoutAttribute($name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-3-Psr-Http-Message-ResponseInterface"><a href="#2-3-Psr-Http-Message-ResponseInterface" class="headerlink" title="2.3 Psr\Http\Message\ResponseInterface"></a>2.3 <code>Psr\Http\Message\ResponseInterface</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace Psr\Http\Message;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 表示服务器返回的响应消息。</span><br><span class="line"> *</span><br><span class="line"> * 根据 HTTP 规范，此接口包含以下各项的属性：</span><br><span class="line"> *</span><br><span class="line"> * - 协议版本</span><br><span class="line"> * - 状态码和原因短语</span><br><span class="line"> * - 报头</span><br><span class="line"> * - 消息体</span><br><span class="line"> * </span><br><span class="line"> * HTTP 响应是被视为无法修改的，所有能修改状态的方法，都 **必须** 有一套机制，在内部保</span><br><span class="line"> * 持好原有的内容，然后把修改状态后的，新的 HTTP 响应实例返回。</span><br><span class="line"> */</span><br><span class="line">interface ResponseInterface extends MessageInterface</span><br><span class="line">&#123;</span><br><span class="line">    /**</span><br><span class="line">     * 获取响应状态码。</span><br><span class="line">     *</span><br><span class="line">     * 状态码是一个三位整数，用于理解请求。</span><br><span class="line">     *</span><br><span class="line">     * @return int 状态码。</span><br><span class="line">     */</span><br><span class="line">    public function getStatusCode();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回具有指定状态码和原因短语（可选）的实例。</span><br><span class="line">     *</span><br><span class="line">     * 如果未指定原因短语，实现代码 **可能** 选择 RFC7231 或 IANA 为状态码推荐的原因短语。</span><br><span class="line">     *</span><br><span class="line">     * 此方法在实现的时候，**必须** 保留原有的不可修改的 HTTP 消息实例，然后返回</span><br><span class="line">     * 一个新的修改过的 HTTP 消息实例。</span><br><span class="line">     *</span><br><span class="line">     * @see http://tools.ietf.org/html/rfc7231#section-6</span><br><span class="line">     * @see http://www.iana.org/assignments/http-status-codes/http-status-codes.xhtml</span><br><span class="line">     * @param int $code 三位整数的状态码。</span><br><span class="line">     * @param string $reasonPhrase 为状态码提供的原因短语；如果未提供，实现代码可以使用 HTTP 规范建议的默认代码。</span><br><span class="line">     * @return self</span><br><span class="line">     * @throws \InvalidArgumentException 如果传入无效的状态码，则抛出。</span><br><span class="line">     */</span><br><span class="line">    public function withStatus($code, $reasonPhrase = &apos;&apos;);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取与响应状态码关联的响应原因短语。</span><br><span class="line">     *</span><br><span class="line">     * 因为原因短语不是响应状态行中的必需元素，所以原因短语 **可能** 是空。</span><br><span class="line">     * 实现代码可以选择返回响应的状态代码的默认 RFC 7231 推荐原因短语（或 IANA HTTP 状态码注册表中列出的原因短语）。</span><br><span class="line">     *</span><br><span class="line">     * @see http://tools.ietf.org/html/rfc7231#section-6</span><br><span class="line">     * @see http://www.iana.org/assignments/http-status-codes/http-status-codes.xhtml</span><br><span class="line">     * @return string 原因短语；如果不存在，则 **必须** 返回空字符串。</span><br><span class="line">     */</span><br><span class="line">    public function getReasonPhrase();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="2-4-Psr-Http-Message-StreamInterface"><a href="#2-4-Psr-Http-Message-StreamInterface" class="headerlink" title="2.4 Psr\Http\Message\StreamInterface"></a>2.4 <code>Psr\Http\Message\StreamInterface</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace Psr\Http\Message;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 描述数据流。</span><br><span class="line"> *</span><br><span class="line"> * 通常，实例将包装PHP流; 此接口提供了最常见操作的包装，包括将整个流序列化为字符串。</span><br><span class="line"> */</span><br><span class="line">interface StreamInterface</span><br><span class="line">&#123;</span><br><span class="line">    /**</span><br><span class="line">     * 从头到尾将流中的所有数据读取到字符串。</span><br><span class="line">     *</span><br><span class="line">     * 这个方法 **必须** 在开始读数据前定位到流的开头，并读取出所有的数据。</span><br><span class="line">     *</span><br><span class="line">     * 警告：这可能会尝试将大量数据加载到内存中。</span><br><span class="line">     *</span><br><span class="line">     * 这个方法 **不得** 抛出异常以符合 PHP 的字符串转换操作。</span><br><span class="line">     *</span><br><span class="line">     * @see http://php.net/manual/en/language.oop5.magic.php#object.tostring</span><br><span class="line">     * @return string</span><br><span class="line">     */</span><br><span class="line">    public function __toString();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 关闭流和任何底层资源。</span><br><span class="line">     *</span><br><span class="line">     * @return void</span><br><span class="line">     */</span><br><span class="line">    public function close();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 从流中分离任何底层资源。</span><br><span class="line">     *</span><br><span class="line">     * 分离之后，流处于不可用状态。</span><br><span class="line">     *</span><br><span class="line">     * @return resource|null 如果存在的话，返回底层 PHP 流。</span><br><span class="line">     */</span><br><span class="line">    public function detach();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 如果可知，获取流的数据大小。</span><br><span class="line">     *</span><br><span class="line">     * @return int|null 如果可知，返回以字节为单位的大小，如果未知返回 `null`。</span><br><span class="line">     */</span><br><span class="line">    public function getSize();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回当前读/写的指针位置。</span><br><span class="line">     *</span><br><span class="line">     * @return int 指针位置。</span><br><span class="line">     * @throws \RuntimeException 产生错误时抛出。</span><br><span class="line">     */</span><br><span class="line">    public function tell();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回是否位于流的末尾。</span><br><span class="line">     *</span><br><span class="line">     * @return bool</span><br><span class="line">     */</span><br><span class="line">    public function eof();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回流是否可随机读取。</span><br><span class="line">     *</span><br><span class="line">     * @return bool</span><br><span class="line">     */</span><br><span class="line">    public function isSeekable();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 定位流中的指定位置。</span><br><span class="line">     *</span><br><span class="line">     * @see http://www.php.net/manual/en/function.fseek.php</span><br><span class="line">     * @param int $offset 要定位的流的偏移量。</span><br><span class="line">     * @param int $whence 指定如何根据偏移量计算光标位置。有效值与 PHP 内置函数 `fseek()` 相同。</span><br><span class="line">     *     SEEK_SET：设定位置等于 $offset 字节。默认。</span><br><span class="line">     *     SEEK_CUR：设定位置为当前位置加上 $offset。</span><br><span class="line">     *     SEEK_END：设定位置为文件末尾加上 $offset （要移动到文件尾之前的位置，offset 必须是一个负值）。</span><br><span class="line">     * @throws \RuntimeException 失败时抛出。</span><br><span class="line">     */</span><br><span class="line">    public function seek($offset, $whence = SEEK_SET);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 定位流的起始位置。</span><br><span class="line">     *</span><br><span class="line">     * 如果流不可以随机访问，此方法将引发异常；否则将执行 seek(0)。</span><br><span class="line">     *</span><br><span class="line">     * @see seek()</span><br><span class="line">     * @see http://www.php.net/manual/en/function.fseek.php</span><br><span class="line">     * @throws \RuntimeException 失败时抛出。</span><br><span class="line">     */</span><br><span class="line">    public function rewind();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回流是否可写。</span><br><span class="line">     *</span><br><span class="line">     * @return bool</span><br><span class="line">     */</span><br><span class="line">    public function isWritable();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 向流中写数据。</span><br><span class="line">     *</span><br><span class="line">     * @param string $string 要写入流的数据。</span><br><span class="line">     * @return int 返回写入流的字节数。</span><br><span class="line">     * @throws \RuntimeException 失败时抛出。</span><br><span class="line">     */</span><br><span class="line">    public function write($string);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回流是否可读。</span><br><span class="line">     *</span><br><span class="line">     * @return bool</span><br><span class="line">     */</span><br><span class="line">    public function isReadable();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 从流中读取数据。</span><br><span class="line">     *</span><br><span class="line">     * @param int $length 从流中读取最多 $length 字节的数据并返回。如果数据不足，则可能返回少于</span><br><span class="line">     *     $length 字节的数据。</span><br><span class="line">     * @return string 返回从流中读取的数据，如果没有可用的数据则返回空字符串。</span><br><span class="line">     * @throws \RuntimeException 失败时抛出。</span><br><span class="line">     */</span><br><span class="line">    public function read($length);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回字符串中的剩余内容。</span><br><span class="line">     *</span><br><span class="line">     * @return string</span><br><span class="line">     * @throws \RuntimeException 如果无法读取则抛出异常。</span><br><span class="line">     * @throws \RuntimeException 如果在读取时发生错误则抛出异常。</span><br><span class="line">     */</span><br><span class="line">    public function getContents();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取流中的元数据作为关联数组，或者检索指定的键。</span><br><span class="line">     *</span><br><span class="line">     * 返回的键与从 PHP 的 stream_get_meta_data() 函数返回的键相同。</span><br><span class="line">     *</span><br><span class="line">     * @see http://php.net/manual/en/function.stream-get-meta-data.php</span><br><span class="line">     * @param string $key 要检索的特定元数据。</span><br><span class="line">     * @return array|mixed|null 如果没有键，则返回关联数组。如果提供了键并且找到值，</span><br><span class="line">     *     则返回特定键值；如果未找到键，则返回 null。</span><br><span class="line">     */</span><br><span class="line">    public function getMetadata($key = null);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="2-5-Psr-Http-Message-UriInterface"><a href="#2-5-Psr-Http-Message-UriInterface" class="headerlink" title="2.5 Psr\Http\Message\UriInterface"></a>2.5 <code>Psr\Http\Message\UriInterface</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace Psr\Http\Message;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * URI 数据对象。</span><br><span class="line"> *</span><br><span class="line"> * 此接口按照 RFC 3986 来构建 HTTP URI，提供了一些通用的操作，你可以自由的对此接口</span><br><span class="line"> * 进行扩展。你可以使用此 URI 接口来做 HTTP 相关的操作，也可以使用此接口做任何 URI </span><br><span class="line"> * 相关的操作。</span><br><span class="line"> *</span><br><span class="line"> * 此接口的实例化对象被视为无法修改的，所有能修改状态的方法，都 **必须** 有一套机制，在内部保</span><br><span class="line"> * 持好原有的内容，然后把修改状态后的，新的实例返回。</span><br><span class="line"> *</span><br><span class="line"> * 通常，HOST 信息也将出现在请求消息中。对于服务器端的请求，通常可以在服务器参数中发现此信息。</span><br><span class="line"> * </span><br><span class="line"> * @see [URI 通用标准规范](http://tools.ietf.org/html/rfc3986)</span><br><span class="line"> */</span><br><span class="line">interface UriInterface</span><br><span class="line">&#123;</span><br><span class="line">    /**</span><br><span class="line">     * 从 URI 中取出 scheme。</span><br><span class="line">     *</span><br><span class="line">     * 如果不存在 Scheme，此方法 **必须** 返回空字符串。</span><br><span class="line">     *</span><br><span class="line">     * 根据 RFC 3986 规范 3.1 章节，返回的数据 **必须** 是小写字母。</span><br><span class="line">     *</span><br><span class="line">     * 最后部分的「:」字串不属于 Scheme，**不得** 作为返回数据的一部分。</span><br><span class="line">     *</span><br><span class="line">     * @see https://tools.ietf.org/html/rfc3986#section-3.1</span><br><span class="line">     * @return string URI Ccheme 的值。</span><br><span class="line">     */</span><br><span class="line">    public function getScheme();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回 URI 认证信息。</span><br><span class="line">     *</span><br><span class="line">     * 如果没有 URI 认证信息的话，**必须** 返回一个空字符串。</span><br><span class="line">     *</span><br><span class="line">     * URI 的认证信息语法是：</span><br><span class="line">     *</span><br><span class="line">     * &lt;pre&gt;</span><br><span class="line">     * [user-info@]host[:port]</span><br><span class="line">     * &lt;/pre&gt;</span><br><span class="line">     *</span><br><span class="line">     * 如果端口部分没有设置，或者端口是标准端口，**不应该** 包含在返回值内。</span><br><span class="line">     *</span><br><span class="line">     * @see https://tools.ietf.org/html/rfc3986#section-3.2</span><br><span class="line">     * @return string URI 认证信息，格式为：「[user-info@]host[:port]」。</span><br><span class="line">     */</span><br><span class="line">    public function getAuthority();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 从 URI 中获取用户信息。</span><br><span class="line">     *</span><br><span class="line">     * 如果不存在用户信息，此方法 **必须** 返回一个空字符串。</span><br><span class="line">     * </span><br><span class="line">     * 如果 URI 中存在用户，则返回该值；此外，如果密码也存在，它将附加到用户值，用冒号（「:」）分隔。</span><br><span class="line">     *</span><br><span class="line">     * 用户信息后面跟着的 &quot;@&quot; 字符，不是用户信息里面的一部分，**不得** 在返回值里出现。</span><br><span class="line">     *</span><br><span class="line">     * @return string URI 的用户信息，格式：&quot;username[:password]&quot; </span><br><span class="line">     */</span><br><span class="line">    public function getUserInfo();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 从 URI 中获取 HOST 信息。</span><br><span class="line">     *</span><br><span class="line">     * 如果 URI 中没有此值，**必须** 返回空字符串。</span><br><span class="line">     *</span><br><span class="line">     * 根据 RFC 3986 规范 3.2.2 章节，返回的数据 **必须** 是小写字母。</span><br><span class="line">     *</span><br><span class="line">     * @see http://tools.ietf.org/html/rfc3986#section-3.2.2</span><br><span class="line">     * @return string URI 中的 HOST 信息。</span><br><span class="line">     */</span><br><span class="line">    public function getHost();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 从 URI 中获取端口信息。</span><br><span class="line">     *</span><br><span class="line">     * 如果端口信息是与当前 Scheme 的标准端口不匹配的话，就使用整数值的格式返回，如果是一</span><br><span class="line">     * 样的话，**应该** 返回 `null` 值。</span><br><span class="line">     * </span><br><span class="line">     * 如果不存在端口和 Scheme 信息，**必须** 返回 `null` 值。</span><br><span class="line">     * </span><br><span class="line">     * 如果不存在端口数据，但是存在 Scheme 的话，**可能** 返回 Scheme 对应的</span><br><span class="line">     * 标准端口，但是 **应该** 返回 `null`。</span><br><span class="line">     * </span><br><span class="line">     * @return null|int URI 中的端口信息。</span><br><span class="line">     */</span><br><span class="line">    public function getPort();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 从 URI 中获取路径信息。</span><br><span class="line">     *</span><br><span class="line">     * 路径可以是空的，或者是绝对的（以斜线「/」开头），或者相对路径（不以斜线开头）。</span><br><span class="line">     * 实现 **必须** 支持所有三种语法。</span><br><span class="line">     *</span><br><span class="line">     * 根据 RFC 7230 第 2.7.3 节，通常空路径「」和绝对路径「/」被认为是相同的。</span><br><span class="line">     * 但是这个方法 **不得** 自动进行这种规范化，因为在具有修剪的基本路径的上下文中，</span><br><span class="line">     * 例如前端控制器中，这种差异将变得显著。用户的任务就是可以将「」和「/」都处理好。</span><br><span class="line">     *</span><br><span class="line">     * 返回的值 **必须** 是百分号编码，但 **不得** 对任何字符进行双重编码。</span><br><span class="line">     * 要确定要编码的字符，请参阅 RFC 3986 第 2 节和第 3.3 节。</span><br><span class="line">     *</span><br><span class="line">     * 例如，如果值包含斜线（「/」）而不是路径段之间的分隔符，则该值必须以编码形式（例如「%2F」）</span><br><span class="line">     * 传递给实例。</span><br><span class="line">     *</span><br><span class="line">     * @see https://tools.ietf.org/html/rfc3986#section-2</span><br><span class="line">     * @see https://tools.ietf.org/html/rfc3986#section-3.3</span><br><span class="line">     * @return string URI 路径信息。</span><br><span class="line">     */</span><br><span class="line">    public function getPath();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取 URI 中的查询字符串。</span><br><span class="line">     *</span><br><span class="line">     * 如果不存在查询字符串，则此方法必须返回空字符串。</span><br><span class="line">     *</span><br><span class="line">     * 前导的「?」字符不是查询字符串的一部分，**不得** 添加在返回值中。</span><br><span class="line">     *</span><br><span class="line">     * 返回的值 **必须** 是百分号编码，但 **不得** 对任何字符进行双重编码。</span><br><span class="line">     * 要确定要编码的字符，请参阅 RFC 3986 第 2 节和第 3.4 节。</span><br><span class="line">     *</span><br><span class="line">     * 例如，如果查询字符串的键值对中的值包含不做为值之间分隔符的（「&amp;」），则该值必须</span><br><span class="line">     * 以编码形式传递（例如「%26」）到实例。</span><br><span class="line">     *</span><br><span class="line">     * @see https://tools.ietf.org/html/rfc3986#section-2</span><br><span class="line">     * @see https://tools.ietf.org/html/rfc3986#section-3.4</span><br><span class="line">     * @return string URI 中的查询字符串</span><br><span class="line">     */</span><br><span class="line">    public function getQuery();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取 URI 中的片段（Fragment）信息。</span><br><span class="line">     *</span><br><span class="line">     * 如果没有片段信息，此方法 **必须** 返回空字符串。</span><br><span class="line">     *</span><br><span class="line">     * 前导的「#」字符不是片段的一部分，**不得** 添加在返回值中。</span><br><span class="line">     *</span><br><span class="line">     * 返回的值 **必须** 是百分号编码，但 **不得** 对任何字符进行双重编码。</span><br><span class="line">     * 要确定要编码的字符，请参阅 RFC 3986 第 2 节和第 3.5 节。</span><br><span class="line">     *</span><br><span class="line">     * @see https://tools.ietf.org/html/rfc3986#section-2</span><br><span class="line">     * @see https://tools.ietf.org/html/rfc3986#section-3.5</span><br><span class="line">     * @return string URI 中的片段信息。</span><br><span class="line">     */</span><br><span class="line">    public function getFragment();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回具有指定 Scheme 的实例。</span><br><span class="line">     *</span><br><span class="line">     * 此方法 **必须** 保留当前实例的状态，并返回包含指定 Scheme 的实例。</span><br><span class="line">     *</span><br><span class="line">     * 实现 **必须** 支持大小写不敏感的「http」和「https」的 Scheme，并且在</span><br><span class="line">     * 需要的时候 **可能** 支持其他的 Scheme。</span><br><span class="line">     *</span><br><span class="line">     * 空的 Scheme 相当于删除 Scheme。</span><br><span class="line">     *</span><br><span class="line">     * @param string $scheme 给新实例使用的 Scheme。</span><br><span class="line">     * @return self 具有指定 Scheme 的新实例。</span><br><span class="line">     * @throws \InvalidArgumentException 使用无效的 Scheme 时抛出。</span><br><span class="line">     * @throws \InvalidArgumentException 使用不支持的 Scheme 时抛出。</span><br><span class="line">     */</span><br><span class="line">    public function withScheme($scheme);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回具有指定用户信息的实例。</span><br><span class="line">     *</span><br><span class="line">     * 此方法 **必须** 保留当前实例的状态，并返回包含指定用户信息的实例。</span><br><span class="line">     *</span><br><span class="line">     * 密码是可选的，但用户信息 **必须** 包括用户；用户信息的空字符串相当于删除用户信息。</span><br><span class="line">     * </span><br><span class="line">     * @param string $user 用于认证的用户名。</span><br><span class="line">     * @param null|string $password 密码。</span><br><span class="line">     * @return self 具有指定用户信息的新实例。</span><br><span class="line">     */</span><br><span class="line">    public function withUserInfo($user, $password = null);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回具有指定 HOST 信息的实例。</span><br><span class="line">     *</span><br><span class="line">     * 此方法 **必须** 保留当前实例的状态，并返回包含指定 HOST 信息的实例。</span><br><span class="line">     *</span><br><span class="line">     * 空的 HOST 信息等同于删除 HOST 信息。</span><br><span class="line">     *</span><br><span class="line">     * @param string $host 用于新实例的 HOST 信息。</span><br><span class="line">     * @return self 具有指定 HOST 信息的实例。</span><br><span class="line">     * @throws \InvalidArgumentException 使用无效的 HOST 信息时抛出。</span><br><span class="line">     */</span><br><span class="line">    public function withHost($host);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回具有指定端口的实例。</span><br><span class="line">     *</span><br><span class="line">     * 此方法 **必须** 保留当前实例的状态，并返回包含指定端口的实例。</span><br><span class="line">     *</span><br><span class="line">     * 实现 **必须** 为已建立的 TCP 和 UDP 端口范围之外的端口引发异常。</span><br><span class="line">     *</span><br><span class="line">     * 为端口提供的空值等同于删除端口信息。</span><br><span class="line">     *</span><br><span class="line">     * @param null|int $port 用于新实例的端口；`null` 值将删除端口信息。</span><br><span class="line">     * @return self 具有指定端口的实例。</span><br><span class="line">     * @throws \InvalidArgumentException 使用无效端口时抛出异常。</span><br><span class="line">     */</span><br><span class="line">    public function withPort($port);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回具有指定路径的实例。</span><br><span class="line">     *</span><br><span class="line">     * 此方法 **必须** 保留当前实例的状态，并返回包含指定路径的实例。</span><br><span class="line">     *</span><br><span class="line">     * 路径可以是空的、绝对的（以斜线开头）或者相对路径（不以斜线开头），实现必须支持这三种语法。</span><br><span class="line">     *</span><br><span class="line">     * 如果 HTTP 路径旨在与 HOST 相对而不是路径相对，，那么它必须以斜线开头。</span><br><span class="line">     * 假设 HTTP 路径不以斜线开头，对应该程序或开发人员来说，相对于一些已知的路径。</span><br><span class="line">     *</span><br><span class="line">     * 用户可以提供编码和解码的路径字符，要确保实现了 `getPath()` 中描述的正确编码。</span><br><span class="line">     *</span><br><span class="line">     * @param string $path 用于新实例的路径。</span><br><span class="line">     * @return self 具有指定路径的实例。</span><br><span class="line">     * @throws \InvalidArgumentException 使用无效的路径时抛出。</span><br><span class="line">     */</span><br><span class="line">    public function withPath($path);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回具有指定查询字符串的实例。</span><br><span class="line">     *</span><br><span class="line">     * 此方法 **必须** 保留当前实例的状态，并返回包含查询字符串的实例。</span><br><span class="line">     *</span><br><span class="line">     * 用户可以提供编码和解码的查询字符串，要确保实现了 `getQuery()` 中描述的正确编码。</span><br><span class="line">     *</span><br><span class="line">     * 空查询字符串值等同于删除查询字符串。</span><br><span class="line">     *</span><br><span class="line">     * @param string $query 用于新实例的查询字符串。</span><br><span class="line">     * @return self 具有指定查询字符串的实例。</span><br><span class="line">     * @throws \InvalidArgumentException 使用无效的查询字符串时抛出。</span><br><span class="line">     */</span><br><span class="line">    public function withQuery($query);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回具有指定 URI 片段（Fragment）的实例。</span><br><span class="line">     *</span><br><span class="line">     * 此方法 **必须** 保留当前实例的状态，并返回包含片段的实例。</span><br><span class="line">     *</span><br><span class="line">     * 用户可以提供编码和解码的片段，要确保实现了 `getFragment()` 中描述的正确编码。</span><br><span class="line">     *</span><br><span class="line">     * 空片段值等同于删除片段。</span><br><span class="line">     *</span><br><span class="line">     * @param string $fragment 用于新实例的片段。</span><br><span class="line">     * @return self 具有指定 URI 片段的实例。</span><br><span class="line">     */</span><br><span class="line">    public function withFragment($fragment);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 返回字符串表示形式的 URI。</span><br><span class="line">     *</span><br><span class="line">     * 根据 RFC 3986 第 4.1 节，结果字符串是完整的 URI 还是相对引用，取决于 URI 有哪些组件。</span><br><span class="line">     * 该方法使用适当的分隔符连接 URI 的各个组件：</span><br><span class="line">     *</span><br><span class="line">     * - 如果存在 Scheme 则 **必须** 以「:」为后缀。</span><br><span class="line">     * - 如果存在认证信息，则必须以「//」作为前缀。</span><br><span class="line">     * - 路径可以在没有分隔符的情况下连接。但是有两种情况需要调整路径以使 URI 引用有效，因为 PHP</span><br><span class="line">     *   不允许在 `__toString()` 中引发异常：</span><br><span class="line">     *     - 如果路径是相对的并且有认证信息，则路径 **必须** 以「/」为前缀。</span><br><span class="line">     *     - 如果路径以多个「/」开头并且没有认证信息，则起始斜线 **必须** 为一个。</span><br><span class="line">     * - 如果存在查询字符串，则 **必须** 以「?」作为前缀。</span><br><span class="line">     * - 如果存在片段（Fragment），则 **必须** 以「#」作为前缀。</span><br><span class="line">     *</span><br><span class="line">     * @see http://tools.ietf.org/html/rfc3986#section-4.1</span><br><span class="line">     * @return string</span><br><span class="line">     */</span><br><span class="line">    public function __toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="2-6-Psr-Http-Message-UploadedFileInterface"><a href="#2-6-Psr-Http-Message-UploadedFileInterface" class="headerlink" title="2.6 Psr\Http\Message\UploadedFileInterface"></a>2.6 <code>Psr\Http\Message\UploadedFileInterface</code></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace Psr\Http\Message;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 通过 HTTP 请求上传的一个文件内容。</span><br><span class="line"> *</span><br><span class="line"> * 此接口的实例是被视为无法修改的，所有能修改状态的方法，都 **必须** 有一套机制，在内部保</span><br><span class="line"> * 持好原有的内容，然后把修改状态后的，新的实例返回。</span><br><span class="line"> */</span><br><span class="line">interface UploadedFileInterface</span><br><span class="line">&#123;</span><br><span class="line">    /**</span><br><span class="line">     * 获取上传文件的数据流。</span><br><span class="line">     *</span><br><span class="line">     * 此方法必须返回一个 `StreamInterface` 实例，此方法的目的在于允许 PHP 对获取到的数</span><br><span class="line">     * 据流直接操作，如 stream_copy_to_stream() 。</span><br><span class="line">     *</span><br><span class="line">     * 如果在调用此方法之前调用了 `moveTo()` 方法，此方法 **必须** 抛出异常。</span><br><span class="line">     *</span><br><span class="line">     * @return StreamInterface 上传文件的数据流</span><br><span class="line">     * @throws \RuntimeException 没有数据流的情形下。</span><br><span class="line">     * @throws \RuntimeException 无法创建数据流。</span><br><span class="line">     */</span><br><span class="line">    public function getStream();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 把上传的文件移动到新目录。</span><br><span class="line">     *</span><br><span class="line">     * 此方法保证能同时在 `SAPI` 和 `non-SAPI` 环境下使用。实现类库 **必须** 判断</span><br><span class="line">     * 当前处在什么环境下，并且使用合适的方法来处理，如 move_uploaded_file(), rename()</span><br><span class="line">     * 或者数据流操作。</span><br><span class="line">     *</span><br><span class="line">     * $targetPath 可以是相对路径，也可以是绝对路径，使用 rename() 解析起来应该是一样的。</span><br><span class="line">     *</span><br><span class="line">     * 当这一次完成后，原来的文件 **必须** 会被移除。</span><br><span class="line">     * </span><br><span class="line">     * 如果此方法被调用多次，一次以后的其他调用，都要抛出异常。</span><br><span class="line">     *</span><br><span class="line">     * 如果在 SAPI 环境下的话，$_FILES 内有值，当使用  moveTo(), is_uploaded_file()</span><br><span class="line">     * 和 move_uploaded_file() 方法来移动文件时 **应该** 确保权限和上传状态的准确性。</span><br><span class="line">     * </span><br><span class="line">     * 如果你希望操作数据流的话，请使用 `getStream()` 方法，因为在 SAPI 场景下，无法</span><br><span class="line">     * 保证书写入数据流目标。</span><br><span class="line">     * </span><br><span class="line">     * @see http://php.net/is_uploaded_file</span><br><span class="line">     * @see http://php.net/move_uploaded_file</span><br><span class="line">     * @param string $targetPath 目标文件路径。</span><br><span class="line">     * @throws \InvalidArgumentException 参数有问题时抛出异常。</span><br><span class="line">     * @throws \RuntimeException 发生任何错误，都抛出此异常。</span><br><span class="line">     * @throws \RuntimeException 多次运行，也抛出此异常。</span><br><span class="line">     */</span><br><span class="line">    public function moveTo($targetPath);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取文件大小。</span><br><span class="line">     *</span><br><span class="line">     * 实现类库 **应该** 优先使用 $_FILES 里的 `size` 数值。</span><br><span class="line">     * </span><br><span class="line">     * @return int|null 以 bytes 为单位，或者 null 未知的情况下。</span><br><span class="line">     */</span><br><span class="line">    public function getSize();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取上传文件时出现的错误。</span><br><span class="line">     *</span><br><span class="line">     * 返回值 **必须** 是 PHP 的 UPLOAD_ERR_XXX 常量。</span><br><span class="line">     *</span><br><span class="line">     * 如果文件上传成功，此方法 **必须** 返回 UPLOAD_ERR_OK。</span><br><span class="line">     *</span><br><span class="line">     * 实现类库 **必须** 返回 $_FILES 数组中的 `error` 值。</span><br><span class="line">     * </span><br><span class="line">     * @see http://php.net/manual/en/features.file-upload.errors.php</span><br><span class="line">     * @return int PHP 的 UPLOAD_ERR_XXX 常量。</span><br><span class="line">     */</span><br><span class="line">    public function getError();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取客户端上传的文件的名称。</span><br><span class="line">     * </span><br><span class="line">     * 永远不要信任此方法返回的数据，客户端有可能发送了一个恶意的文件名来攻击你的程序。</span><br><span class="line">     * </span><br><span class="line">     * 实现类库 **应该** 返回存储在 $_FILES 数组中 `name` 的值。</span><br><span class="line">     *</span><br><span class="line">     * @return string|null 用户上传的名字，或者 null 如果没有此值。</span><br><span class="line">     */</span><br><span class="line">    public function getClientFilename();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 客户端提交的文件类型。</span><br><span class="line">     * </span><br><span class="line">     * 永远不要信任此方法返回的数据，客户端有可能发送了一个恶意的文件类型名称来攻击你的程序。</span><br><span class="line">     *</span><br><span class="line">     * 实现类库 **应该** 返回存储在 $_FILES 数组中 `type` 的值。</span><br><span class="line">     *</span><br><span class="line">     * @return string|null 用户上传的类型，或者 null 如果没有此值。</span><br><span class="line">     */</span><br><span class="line">    public function getClientMediaType();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2019-02-21</span><i class="fa fa-tag"></i><a class="tag" href="/tags/php/" title="php">php </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,https://tonety.github.io/2019/02/21/PSR-7-HTTP消息接口规范/,Tonety,PSR-7 HTTP消息接口规范,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2019/03/01/psr4自动加载流程分析/" title="PSR-4自动加载流程分析">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2019/02/15/用redis实现定时任务/" title="用redis实现定时任务">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>